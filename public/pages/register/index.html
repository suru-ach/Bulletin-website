<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../output.css">
    <title>Register</title>
</head>
<body>
    <div class="w-screen h-screen">
        <div class="w-full h-full flex flex-col lg:flex-row lg:justify-evenly justify-start items-center sm:bg-sky-50">

            <div class="flex flex-col justify-center items-center p-2 space-x-2">
                <a href="../../index.html" class="flex items-center space-x-2 my-4">
                    <img src="../../icons/home-icon.png" alt="home">
                    <p>bulletin</p>
                </a>
                <p class="hidden lg:block">Get the latest updates and more</p>
            </div>

            <div>
                <div class="w-full sm:w-96 mt-4 p-4 bg-white sm:shadow-md sm:rounded-md flex flex-col items-center">
                    <h1 class="text-3xl ">register</h1>
                    <p id="message-box" class="text-sm mt-3 invisible text-black"></p>
                    <form id="form" class="flex flex-col w-full space-y-2 pt-5">
                        <label for="username">username</label>
                        <input id="username" name="username" class="p-3 border-2 border-slate-200 rounded-md focus:outline-none focus:border-sky-500" type="text" placeholder="enter your name" required>
                        <label for="email">email</label>
                        <input id="email" name="email" class="p-3 border-2 border-slate-200 rounded-md focus:outline-none focus:border-sky-500" type="email" placeholder="enter your email" required>
                        <label for="password">password</label>
                        <input id="password" name="password" class="p-3 border-2 border-slate-200 rounded-md focus:outline-none focus:border-sky-500" type="password" placeholder="password" required>
                        <p>clubs</p>
                        <fieldset id="clubs">
                          <label for="aura">aura</label>
                          <input type="checkbox" id="aura">
                          <label for="flc">flc</label>
                          <input type="checkbox" id="flc">
                          <label for="music">music</label>
                          <input type="checkbox" id="music">
                        </fieldset>
                        <button id="submit" class="p-3 bg-sky-500 text-white rounded-md hover:bg-sky-400" type="submit">register</button>
                    </form>
                </div>
            
                <p class="my-6">already have an account? <a class="text-blue-600 underline" href="../login/index.html">sign in</a></p>
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>

        const email = document.getElementById('email');
        const password = document.getElementById('password');
        const username = document.getElementById('username');
        const clubs = Array.from(document.querySelectorAll('input[type="checkbox"]'));
        const submit = document.getElementById('submit');
        const form = document.getElementById('form');

        const message = document.getElementById('message-box');

        const setToken = (data) => {
            for(key in data) {
                localStorage.setItem(key, data[key]);
            }
        };

        const postData = async(e) => {
            e.preventDefault();
            message.style.visibility = 'visible';
            message.innerHTML = 'loading';
            submit.classList.add('cursor-not-allowed');
            submit.disabled = true;
            const inputClubs = clubs.filter(club => club.checked).map(club => club.id);

            const data = { 
                email: email.value,
                password: password.value,
                username: username.value,
                clubs: inputClubs
            };

            try {
                const res = await axios.post('/auth/register', data);
                message.style.color = 'rgb(34 197 94)';
                message.innerHTML = res.data.message;
                setToken(res.data.payload);
            } catch(err) {
                message.style.color = 'rgb(220 38 38)';
                message.innerHTML = err.response.data.message;
            }

            submit.disabled = false;
            submit.classList.remove('cursor-not-allowed');
            setTimeout(() => {
                message.style.visibility = 'hidden';
            }, 3000);
            form.reset();
        };
        
        form.addEventListener('submit', e => postData(e));
    </script>
</body>

</html>